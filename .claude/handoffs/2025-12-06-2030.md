# Handoff - Dotfiles

**Date:** 2025-12-06 20:30 | **Branch:** master

## Summary

Comprehensive comparison of dotfiles repo vs actual system config before server rebuild. Added new modules (vscode, wsl), updated git module with gh credential helper, created wip-backup.sh script, and migrated Claude Code hooks/commands/instructions to vector-memory-mcp repo.

## Completed

- **Compared repo vs real dotfiles** - Identified all config differences between ~/dev/dotfiles and actual ~/.* files
- **Created `modules/linux-amd64/vscode.sh`** - WSL-aware module that adds Windows VSCode PATH on WSL, installs via apt on native Linux
- **Created `modules/linux-amd64/wsl.sh`** - Configures /etc/wsl.conf with systemd=true, appendWindowsPath=false, generateHosts=false
- **Updated `modules/linux-amd64/git.sh`** - Added module_config() that sets up gh credential helper and prompts for user identity
- **Added bootstrap_check() to `setup.sh`** - Checks for git/gh prerequisites at startup, offers to install if missing
- **Created `~/dev/wip-backup.sh`** - Scans ~/dev repos, commits uncommitted changes to WIP_RESTART branch, pushes to origin
- **Moved opencode module to `modules/_pending/`** - Needs investigation; install method outdated
- **Migrated to vector-memory-mcp repo:**
  - `hooks/session-start.sh` - Resets widget counter
  - `hooks/user-prompt-submit.sh` - Injects memories
  - `commands/*.md` - handoff, startup, critical-think, reboot
  - `instructions/*.md` - orchestration, vector-memory

## Key Decisions

- **Leave pyenv/NVM out of repo** - User uses uv for Python, only needs Node@latest + Bun
- **gh CLI is a bootstrap prerequisite** - Added to setup.sh bootstrap_check(), not a separate module (used to clone repo)
- **appendWindowsPath=false in WSL** - Keeps shell startup fast; add specific tools via modules (like vscode)
- **wip-backup.sh uses --no-verify** - Skips pre-commit hooks for WIP backups (tinker-ui has lefthook)
- **wip-backup.sh adds standard .gitignore** - Prevents committing node_modules, __pycache__, .venv, ML models
- **Claude Code config managed by ~/dev/claude-settings** - Dotfiles repo only needs to install claude, not configure it

## Insights & Patterns

- **llm-memory-experiments had 51K files** - No .gitignore, contained node_modules and ML model files; adding gitignore reduced commit to 1 file
- **tinker-ui has lefthook pre-commit** - Blocks commits on knip failures; --no-verify needed for WIP backups
- **WSL generateHosts=false** - Required because user has custom /etc/hosts entry for `aiur` (192.168.4.241)
- **~/.aws and ~/.azure are symlinks** - Point to Windows side (/mnt/c/Users/Kevin/), don't need backup

## Next Steps

- [ ] Back up critical items before server rebuild:
  - `~/.ssh/` (SSH keys)
  - `~/id_rsa_wsl` + `.pub`
  - `~/writing/borrowed-room/` (creative writing, NOT git)
  - `~/.gemini/oauth_creds.json`
- [ ] Push dotfiles master branch to origin
- [ ] Test setup.sh on fresh machine after rebuild
- [ ] Investigate opencode module installation (in _pending/)

## Working Context

**Key files:**
- `/home/aerion/dev/dotfiles/setup.sh` - Main installer with bootstrap_check()
- `/home/aerion/dev/dotfiles/modules/linux-amd64/*.sh` - Platform modules
- `/home/aerion/dev/wip-backup.sh` - Repo backup script
- `/home/aerion/dev/vector-memory-mcp/hooks/` - Claude hooks
- `/home/aerion/dev/vector-memory-mcp/commands/` - Slash commands

**Commands:**
```bash
# Run dotfiles setup
./setup.sh --profile=desktop --zsh

# Backup all repos before rebuild
~/dev/wip-backup.sh

# Check repo branch status
cd ~/dev && for d in */; do echo "=== $d ===" && git -C "$d" branch --show-current 2>/dev/null; done
```

**Repos on WIP_RESTART branch:**
- agent-ui, claude-settings, context-filtering, googledocs-mcp
- kdub-memory-service, linux-settings, llm-memory-experiments
- lore-archivist, mcp-memory-docker, opencode-custom
- resonance, tinker-ui, vector-memory-mcp

## Commits This Session

| Repo | Commit | Message |
|------|--------|---------|
| dotfiles | `83fc432` | Add WSL/VSCode modules, bootstrap check, and git credential config |
| vector-memory-mcp | `d79fb34` | Add Claude Code integration (hooks, commands, instructions) |
